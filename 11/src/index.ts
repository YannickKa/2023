//--------------- Input section ----------------------//
const testInput: string[] = `...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....`.split("\n");

const testInputExpanded = `....#........
.........#...
#............
.............
.............
........#....
.#...........
............#
.............
.............
.........#...
#....#.......`.split("\n");

const realInput: string[] =
  `...................#.............#...........................................#..............................................................
.......................................#.........#..................................................................#.........#........#....
..........#........................................................#................#............#..........................................
...#.................................................#......................................#...............................................
.................#........................................#...............................................#.....#...........................
..............................#...........#.................................................................................................
...............................................#.....................................................................................#......
.............................................................#...........................#..................................................
....#..........#...............................................................#............................................................
................................#................................................................#................#.......................#.
...........................#.............#......................#......................................#....................#...............
#..........#..........#....................................#.............#..................................................................
....................................#..............#..........................................................#........#....................
..........................................................................................#.............................................#...
............................................#.......................#..........................#............................................
.......#...........................................................................#.......................#...................#............
................#...........#.........................#.....................................................................................
................................................#...................................................................#.................#.....
....#....................................................................................#..................................................
............#.......................................................................................#.......................................
...................................#...........................#................................................#...........................
.......#.........#......#....................................................#........................................#.....#...............
......................................................#......................................#..............................................
..#.............................#............#.........................................................#....................................
...........................................................#..........#...........................#........................................#
.............#....................................#.......................................#.........................#...............#.......
.............................#..............................................................................................................
......................#....................#...................#...........#.........#.....................................#................
....................................#..................#.......................................#............#............................#..
..................#.............................#......................................................#....................................
.......#.......................#.......................................#........................................#................#..........
...........................................................................................#................................................
.....................#...........................................................................#........#..................#.......#......
...............................................................#..................#.........................................................
....#.......................................#.............#..........#......................................................................
...........................................................................#............#........................#..........................
.........#...............................................................................................................#..................
..........................#......#..........................................................................................................
..............#..................................#................#.......................................#................................#
..........................................#.................#...................#..................#........................................
.....................................................................................................................................#......
.............................#......................#..................................#..............................#.....................
.....................................#.........................................................................#...........#................
........#..................................................................#................................................................
.#..........................................#........................................................#......................................
....................#..............................................................................................#........................
..........................#........#..........................#......................#...........................................#..........
.......................................................#....................................................................................
................#................................#...........................#...........#.........#...................................#....
......................................................................#.....................................................................
.......................#....................................#.....................#..........#..............................................
........................................#...................................................................................................
..........#..........................................................................................#...........#..........................
...#.........................#....................#.........................................................................................
........................................................................#................................................#..............#...
............................................................................................................................................
.......................#..............................#......#..........................#...................................................
.............................................................................#................................#.......#.....................
............................................................................................................................................
................#..................................#.........................................................................#............#.
...........................#.........#..............................#.....#........#................................................#.......
......................#.............................................................................#......#................................
.........#.....................................#........................................................................#...................
..............#................................................#...............................#............................................
.....#...........................#.....................................................................#....................................
....................................................................................#..............................................#........
............................#..............#.......#......................................#................................................#
...........#.............................................#................#.....#.....................................#.....................
....................#............................................................................#...........................#..............
...................................#.............................................................................#...................#......
....#.........#.....................................................#......................................#................................
.........................#......................#..........#................#...............................................................
...................................................................................#......#.................................................
.................#.............................................#............................................................................
.............................#.....................#.................................................#......................................
.........#.............#..................................................................................#........................#........
.......................................#.................................#.....................#......................#...................#.
...............................................#................................#...........................................................
..#....................................................#............#.............................................#...........#.............
............................................................................................................................................
....................................#..............#............#...........................................................................
...........#...................#........................................#.................#..............#.................................#
....................#...............................................................#...............#.......................................
...........................................#...................................#..............................#.......#.....................
......#..........................................#.........#.........#..........................#................................#..........
..............#.............................................................................................................................
............................................................................................................................................
...#...........................................................#.....................................#.....#..............#.................
............................................................................................................................................
........................................#.......#.........#..................#....................................#.......................#.
.....................................................................................................................................#......
.................#.....#........#..........................................................#.................#..............................
.....................................#.................#.................#...............................................#.....#............
.........................................................................................................#..................................
..................................................................#.........................................................................
..............................................#...........#....................#.........................................................#..
..................................#.........................................................................................................
..........#..........................................................................#.......................#.....#........................
.....#..............#.......#..................................#............................................................................
............................................#.................................................#............................#.......#........
..............#..........................................#.................................................................................#
..........................................................................#..........................#......................................
.................................#..............................................#......#....................................................
#.......#..................................................................................................#.....#......................#...
........................................#..........#........................................................................................
............................................................................................#..............................#................
...........................#..........................................#.....................................................................
....................#..........................#..................................................................................#.........
..........................................................#.............................#.......#.............#.............................
#......#........#...................#..............................#.................................................#......................
.........................#.................#..............................#....................................................#............
..............................#....................................................#................#.......................................
................................................................................................................#........#..................
...........#...........................#............#.......................................................................................
...................#.........................................................................#..............................................
...........................................................................#.........#..........................................#...........
..#.............................#..................................#..................................#.............#.......................
................#........#...............#..................................................................#........................#......
...........................................................................................#................................................
..................................................#......#.....................#............................................................
#.........................................................................................................................#.................
......#............#..........................#.............................................................................................
..............#........................................................................#..........................#.........................
................................#............................................................................................#..............
.......................#.........................#......................#..................#.............................................#..
..#.....................................................#.......................#................#.......#..................................
............................................................................................................................................
..............................................................#.............................................................................
...................#.....................#..........................................................................#..........#............
.........#..........................................................................................#.......................................
..........................#......#...............#.....#....................................................................................
.............#.........................................................#......................#.............................................
............................................................#..................#........................#................................#..
..................#....................................................................................................#........#...........
.....#.....................................................................#.................................#..............................
..................................................#.........................................................................................
.....................................#..............................................#........#......#...............................#.......
............................................................................................................................................
...........................#............................#..........#......................................................#.................
#............#.......#...................................................#.......................#..........................................`.split(
    "\n"
  );

//--------------- Function section ----------------------//
interface Coordinate {
  x: number;
  y: number;
}

const invertImage = function (image: string[]): string[] {
  const inverseImage: string[] = [];

  for (let i = 0; i < image[0].length; i++) {
    let colStr: string = "";

    for (let j = 0; j < image.length; j++) {
      colStr += image[j].at(i);
    }

    inverseImage.push(colStr);
    colStr = "";
  }

  return inverseImage;
};

const expandRows = function (image: string[]): string[] {
  const newLine: string = ".".repeat(image[0].length);

  for (let i = 0; i < image.length; i++) {
    if ([...image[i]].filter((a) => a === ".").length == image[i].length) {
      image = [...image.slice(0, i), newLine, ...image.slice(i)];
      i++;
    }
  }

  return image;
};

const expandColumns = function (image: string[]): string[] {
  image = invertImage(image);
  image = expandRows(image);
  image = invertImage(image);
  return image;
};

const expandImage = function (image: string[]): string[] {
  image = expandRows(image);
  image = expandColumns(image);
  return image;
};

const findExpandRows = function (image: string[]): number[] {
  let expandRows: number[] = [];

  for (let i = 0; i < image.length; i++) {
    if ([...image[i]].filter((a) => a === ".").length == image[i].length) {
      expandRows.push(i);
    }
  }

  return expandRows;
};

const findExpandColumns = function (image: string[]): number[] {
  image = invertImage(image);
  const expandColumns = findExpandRows(image);
  image = invertImage(image);
  return expandColumns;
};

const findExpandRowsAndColumns = function (image: string[]): number[][] {
  const expandRows = findExpandRows(image);
  const expandColumns = findExpandColumns(image);
  return [expandRows, expandColumns];
};

const findGalaxyInString = function (line: string): number[] {
  const foundGalaxies = [...line.matchAll(new RegExp("#", "gi"))].map((a) => {
    const index = Number(a.index);
    return index;
  });

  return foundGalaxies;
};

const findGalaxies = function (image: string[]): Coordinate[] {
  let galaxies: Coordinate[] = [];
  for (let i = 0; i < image.length; i++) {
    const foundGalaxies = findGalaxyInString(image[i]);
    foundGalaxies.forEach((galaxy) => {
      galaxies.push({ x: i, y: galaxy });
    });
  }
  return galaxies;
};

const getDistance = function (galaxies: Coordinate[]): number {
  let answer: number = 0;

  for (let i = 0; i < galaxies.length; i++) {
    for (let j = i + 1; j < galaxies.length; j++) {
      const xdiff: number = Math.abs(galaxies[j].x - galaxies[i].x);
      const ydiff: number = Math.abs(galaxies[j].y - galaxies[i].y);
      answer += xdiff + ydiff;
    }
  }

  return answer;
};

const getBigDistance = function (
  galaxies: Coordinate[],
  rows: number[],
  columns: number[],
  expandRate: number
): number {
  let answer: number = 0;

  for (let i = 0; i < galaxies.length; i++) {
    for (let j = i + 1; j < galaxies.length; j++) {
      const xmax: number = Math.max(galaxies[i].x, galaxies[j].x);
      const xmin: number = Math.min(galaxies[i].x, galaxies[j].x);
      const ymax: number = Math.max(galaxies[i].y, galaxies[j].y);
      const ymin: number = Math.min(galaxies[i].y, galaxies[j].y);

      let xdiff: number = xmax - xmin;
      let ydiff: number = ymax - ymin;

      rows.forEach((row) => {
        if (row > xmin && row < xmax) {
          xdiff += expandRate - 1;
        }
      });

      columns.forEach((column) => {
        if (column > ymin && column < ymax) {
          ydiff += expandRate - 1;
        }
      });

      answer += xdiff + ydiff;
    }
  }

  return answer;
};

//--------------- Code section ----------------------//
const input = realInput;
// const image = expandImage(input);
const [rows, columns] = findExpandRowsAndColumns(input);
const galaxies = findGalaxies(input);
// const answer = getDistance(galaxies);
const answer = getBigDistance(galaxies, rows, columns, 1000000);

// console.log(rows, columns);
console.log(answer);
